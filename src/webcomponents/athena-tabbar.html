<dom-module id="athena-tabbar">

<link rel="import" href="athena-tab.html">

<template>

    <style>
        .outer {
            cursor: default;
            font-family: "Lucida Grande", "Lucida Sans Unicode", Verdana, Arial, Helvetica, sans-serif;
            font-size: 11px;
            line-height: 13px;
            transition : background 200ms;
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            background : #cccccc;
        }
    </style>

    <div class="outer">
        <content id="tabs" select="athena-tab"></content>
    </div>

</template>

<script>
    Polymer({
        is: "athena-tabbar",

        properties: {
            selectedIndex: {
                type: Number,
                value: -1,
                notify: true,
                reflectToAttribute: true,
                observer: "_selectedIndexChanged"
            }
        },

        attached() {
            this._observer = Polymer.dom(this.$.tabs).observeNodes(info => {
                this._updateTabListeners(info.addedNodes, this.listen.bind(this));
                this._updateTabListeners(info.removedNodes, this.unlisten.bind(this));
                this._layout();
            });
        },

        detached() {
            this._updateTabListeners(this.getEffectiveChildren(), this.unlisten.bind(this));
            Polymer.dom(this.$.tabs).unobserveNodes(this._observer);
            this._observer = null;
        },

        _updateTabListeners(tabs, listenFn) {
            for (let tab of tabs) {
                listenFn(tab, "click", "_clickTab");
                listenFn(tab, "close", "_closeTab");
            }
        },

        _selectedIndexChanged(selectedIndex) {
            let index = Number(selectedIndex);
            let tabs = this.getEffectiveChildren();
            for (let i = 0; i < tabs.length; ++i) {
                tabs[i].active = (i === index);
            }
        },

        _clickTab(event) {
            this.selectedIndex = event.currentTarget.index;
        },

        _closeTab() {
        },

        _layout() {
            let tabs = this.getEffectiveChildren();
            this.selectedIndex = tabs.length - 1;
            let width = `${100/tabs.length}%`;
            for (let i = 0; i < tabs.length; ++i) {
                tabs[i].index = i;
                tabs[i].width = width;
            }
        }
    });
</script>

</dom-module>